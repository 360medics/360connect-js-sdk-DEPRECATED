<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>360Connect JS SDK - Implicit Grant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.slim.min.js"></script>
    <script src="../dist/360connect-js-sdk.bundle.js"></script>
    <style type="text/css">body { padding: 8px 16px }</style>

    <script>
        // client side code !
        const ENV = 'dev';
        const CLIENT_ID = '1_2kazv0v7xrs444kcgss044s080o80w84co8o0coc0cg4ko0okc';
        const CLIENT_SECRET = '6cmwgzlkgx0kg4wkcs4gk0o0owgc80k44cs0cc8g8sgko40ckc';
        const REDIRECT_URI = 'http://360connect-demo.dev/implicit-grant.html';
        const SCOPE = 'full_scope';
        
        Connect.initialize({
            clientId: CLIENT_ID,
            clientSecret: CLIENT_SECRET,
            environment: ENV,
            package: 'com.demo.medical',
            version: '0.3.2',
            flow: Connect.IMPLICIT_FLOW,
        });

        // just for the demos
        function updateUi(loggedIn, user = null) {
            if (loggedIn) {
                $('#if-logged-in').show()
                $('#if-logged-out').hide()
                $('#info').text(user.surname + ' [userID:'+user.id+']')
            } else {
                $('#if-logged-in').hide()
                $('#if-logged-out').show()
            }
        }

        const oauthParams = {Â state: 'KustomVerifToken', redirectUri: REDIRECT_URI, scope: SCOPE };

        $(function() {
            // show login url for the user
            const loginUrl = Connect.OAuth().getLoginUrl(oauthParams)

            $('a#login-button').attr('href', loginUrl)

            $('#logout-button').bind('click', function(e) {
                e.preventDefault()
                Connect.OAuth().logout()
                updateUi(false)
            })

            // configure what happens after successfull login
            Connect.OAuth().afterLogin(function(data) {
                Connect.OAuth().getLoginStatus(true).then(response => {
                    console.log(response)
                    if (response.status === "connected") {
                        updateUi(true, response.user)
                    } else {
                        updateUi(false)
                    }
                });
            });

            // use true to force a new http request to get login status and user
            // remove true and you'll get data from the cache (which can be usefull)
            Connect.OAuth().getLoginStatus().then(response => {
                if (response.statusCode === 200 && response.status === 'connected') {
                    // now you can get the user
                    // response.user
                    // response.scope
                    // response.status ("connected")
                    // Connect.OAuth().getAccessToken()
                    // Connect.OAuth().getUser()
                    console.log(response)
                    updateUi(true, response.user)
                } else {
                    // send to authorization page (might require login or beeing logged)
                    // Connect.OAuth().login(oauthParams, true);
                    updateUi(false)
                }
            });
        })
    </script>
</head>
<body>
    <div id="if-logged-in" style="display:none">
        <p>You are logged in as <span id="info"></span></p>
        <p><a href="#" id="logout-button">Logout</a></p>
    </div>
    <div id="if-logged-out">
        <p>You are logged out</p>
        <div>
            <p><a href="#" id="login-button">Start flow</a></p>
        </div>
    </div>
</body>
