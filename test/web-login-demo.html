<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>360Connect JS SDK - Testing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.slim.min.js"></script>
    <script src="../dist/360connect-js-sdk.bundle.js"></script>

    <script>
        // client side code !
        const ENV = 'dev';
        const CLIENT_ID = '1_2kazv0v7xrs444kcgss044s080o80w84co8o0coc0cg4ko0okc';
        const CLIENT_SECRET = '6cmwgzlkgx0kg4wkcs4gk0o0owgc80k44cs0cc8g8sgko40ckc';
        const REDIRECT_URI = 'http://360medical.dev/oauth/v2/auth_login_success';
        const SCOPE = 'anon_scope';

        Connect.OAuth()
            .initialize({ clientId: CLIENT_ID, clientSecret: CLIENT_SECRET, environment: ENV });

        // using client_credentials grant type is discouraged
        // use normal OAuth flow insteatd
        // Connect.OAuth()
        //     .getToken({ state: 'amyPeronsStae', scope: [] })
        //     .then(function (res) {
        //         console.log(res.isSuccessful(), res);
        //     });

        // let params = { username: 'romain.bruckert@bluewink.fr', password: 'frenchfrog', scope: SCOPE };
        // Connect.OAuth().requestPasswordGrants(params).then(function (res) {
        //     console.log(res);
        // });

        // Connect.OAuth().getLoginStatus().then(function(res){
        //     console.log(res);
        // });
        //
        // Connect.OAuth().requestImplicitGrants().then(function(res){
        //     console.log(res);
        // });
        
        // set what should be done after login (save tokens on your end maybe?)
        Connect.OAuth().afterLogin(function(data) {
            // console.log(data.code, data.state);
            Connect.OAuth().requestAuthorizationCode({ code: data.code, redirectUri: REDIRECT_URI, scope: SCOPE }).then(function(response) {
                // console.log(response.access_token);
                // console.log(Connect.OAuth().getAccessToken());
                Connect.OAuth().getLoginStatus(true).then(response => {
                    console.log(response);
                });

            });
        });

        $(function() {
            // attach login/authorize prompt on login button
            $('#login-button').on('click', function() {
                Connect.OAuth().loginPrompt({Â state: 'abcd', redirectUri: REDIRECT_URI, scope: SCOPE });
            });
            $('#logout-button').bind('click', function() {
                Connect.OAuth().logout();
            });

            // first check user logged in status
            Connect.OAuth().getLoginStatus(true).then(response => {
                // console.log(Connect.OAuth().getAccessToken());

                if (response.status === "connected") {
                    $('#if-logged-in').show();
                    $('#if-logged-out').hide();

                    var user = Connect.OAuth().getUser();
                    $('#info').text(user.surname + ' [userID:'+user.id+']');

                } else {
                    $('#if-logged-in').hide();
                    $('#if-logged-out').show();
                }
            });
        });
    </script>
</head>
<body>

    <div>
        <login-button id="login-button"></login-button>
    </div>

    <div id="if-logged-in" style="display:none">
        <p>You are logged in as <span id="info"></span></p>
        <p><a href="#" id="logout-button">Logout</a></p>
    </div>
    <div id="if-logged-out">
        <p>You are logged out</p>
    </div>
</body>
